<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Maven构建SpringMVC项目实现注解及数据库事务管理"><meta name="keywords" content="SpringMVC"><meta name="author" content="Xiao Hui"><meta name="copyright" content="Xiao Hui"><title>Maven构建SpringMVC项目实现注解及数据库事务管理 | XIAOHUI'S BLOG</title><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><script src="//code.tidio.co/fut0uxnwfp6sbxufi6qqozmfzutuf3nc.js" async></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><link rel="manifest" href="/manifest.json"><link rel="manifest" href="/manifest.json"><link rel="dns-prefetch" href="https://hm.baidu.com"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?5354c19cfb8a022c0adb15862e841958";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();</script><link rel="dns-prefetch" href="https://www.google-analytics.com"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-109219512-1', 'auto');
ga('send', 'pageview');</script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://v1.hitokoto.cn/?encode=js&amp;charset=utf-8&amp;select=.footer_custom_text" defer></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="XIAOHUI'S BLOG" type="application/atom+xml">
</head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">背景介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E5%B7%A5%E7%A8%8B"><span class="toc-number">2.</span> <span class="toc-text">构建工程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8maven%E6%8F%92%E4%BB%B6%E6%9E%84%E5%BB%BA%E9%A1%B9%E7%9B%AE%E6%A1%86%E6%9E%B6"><span class="toc-number">2.1.</span> <span class="toc-text">用maven插件构建项目框架</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0Source-Fold"><span class="toc-number">2.2.</span> <span class="toc-text">添加Source Fold</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">3.</span> <span class="toc-text">建立数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93hib-demo"><span class="toc-number">3.1.</span> <span class="toc-text">新建数据库hib_demo</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E5%BB%BAt-dept-t-employee%E8%A1%A8%EF%BC%8C%E6%A0%BC%E5%BC%8F%E5%88%86%E5%88%AB%E5%A6%82%E4%B8%8B%EF%BC%9A"><span class="toc-number">3.2.</span> <span class="toc-text">新建t_dept , t_employee表，格式分别如下：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E5%8F%8A%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86"><span class="toc-number">4.</span> <span class="toc-text">注解及数据库事务管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E5%8F%8A%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86%E4%BB%A3%E7%A0%81%E6%B8%85%E5%8D%95"><span class="toc-number">4.1.</span> <span class="toc-text">注解及数据库事务管理代码清单</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Dept-java"><span class="toc-number">4.1.1.</span> <span class="toc-text">Dept.java</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DeptDao-java"><span class="toc-number">4.1.2.</span> <span class="toc-text">DeptDao.java</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TestJdbc-java"><span class="toc-number">4.1.3.</span> <span class="toc-text">TestJdbc.java</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#jsp%E9%A1%B5%E9%9D%A2"><span class="toc-number">4.1.4.</span> <span class="toc-text">jsp页面</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#input-jsp"><span class="toc-number">4.1.4.1.</span> <span class="toc-text">input.jsp</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#save-jsp"><span class="toc-number">4.1.4.2.</span> <span class="toc-text">save.jsp</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E8%BF%9B%E8%A1%8CSpringMvc%E9%85%8D%E7%BD%AE"><span class="toc-number">4.2.</span> <span class="toc-text">项目进行SpringMvc配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEweb-xml"><span class="toc-number">4.2.1.</span> <span class="toc-text">配置web.xml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEspring-servlet-xml"><span class="toc-number">4.2.2.</span> <span class="toc-text">配置spring-servlet.xml</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C"><span class="toc-number">4.3.</span> <span class="toc-text">测试结果</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#spring%E4%BD%BF%E7%94%A8JdbcTemplate%E5%AE%9E%E7%8E%B0MySQL%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">5.</span> <span class="toc-text">spring使用JdbcTemplate实现MySQL存储过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E4%BC%98%E7%82%B9"><span class="toc-number">5.1.</span> <span class="toc-text">存储过程优点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JdbcTemplate%E4%BD%BF%E7%94%A8%E5%8F%82%E8%80%83%E4%B8%80%E4%B8%8B%E9%93%BE%E6%8E%A5"><span class="toc-number">5.2.</span> <span class="toc-text">JdbcTemplate使用参考一下链接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring%E4%BD%BF%E7%94%A8JdbcTemplate%E8%B0%83%E7%94%A8Mysql%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%EF%BC%9A"><span class="toc-number">5.3.</span> <span class="toc-text">Spring使用JdbcTemplate调用Mysql存储过程：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">5.3.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A0%E8%BF%94%E5%9B%9E%E5%80%BC%E7%9A%84%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E8%B0%83%E7%94%A8"><span class="toc-number">5.3.2.</span> <span class="toc-text">无返回值的存储过程调用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E4%BB%A3%E7%A0%81%EF%BC%9A"><span class="toc-number">5.3.2.1.</span> <span class="toc-text">存储过程代码：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#JdbcTemplate%E8%B0%83%E7%94%A8%E8%AF%A5%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E4%BB%A3%E7%A0%81%EF%BC%9A"><span class="toc-number">5.3.2.2.</span> <span class="toc-text">JdbcTemplate调用该存储过程代码：</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%89%E8%BF%94%E5%9B%9E%E5%80%BC%E7%9A%84%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%EF%BC%88%E9%9D%9E%E7%BB%93%E6%9E%9C%E9%9B%86%EF%BC%89"><span class="toc-number">5.3.3.</span> <span class="toc-text">有返回值的存储过程（非结果集）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E4%BB%A3%E7%A0%81%EF%BC%9A-1"><span class="toc-number">5.3.3.1.</span> <span class="toc-text">存储过程代码：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#JdbcTemplate%E8%B0%83%E7%94%A8%E8%AF%A5%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E4%BB%A3%E7%A0%81%EF%BC%9A-1"><span class="toc-number">5.3.3.2.</span> <span class="toc-text">JdbcTemplate调用该存储过程代码：</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://ae01.alicdn.com/kf/HTB16qwvKCzqK1RjSZFHq6z3CpXab.jpg"></div><div class="author-info__name text-center">Xiao Hui</div><div class="author-info__description text-center">万古长空，一朝风月</div><div class="follow-button"><a target="_blank" rel="noopener" href="https://github.com/the-sword">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">21</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">21</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">6</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">Links</div><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="https://molunerfinn.com">Molunerfinn</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://api.ixiaowai.cn/gqapi/gqapi.php)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">XIAOHUI'S BLOG</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> 搜索</span></a></span></div><div id="post-info"><div id="post-title">Maven构建SpringMVC项目实现注解及数据库事务管理</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2016-11-22</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93/">开发总结</a><div class="post-meta-wordcount"><span>字数总计: </span><span class="word-count">3.9k</span><span class="post-meta__separator">|</span><span>阅读时长: 17 分钟</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p>Maven构建SpringMVC项目实现注解及数据库事务管理</p>
<span id="more"></span>
<h2 id="背景介绍"><a href="#背景介绍" class="headerlink" title="背景介绍"></a>背景介绍</h2><h2 id="构建工程"><a href="#构建工程" class="headerlink" title="构建工程"></a>构建工程</h2><p> 本项目搭建工具使用Eclipse。</p>
<h3 id="用maven插件构建项目框架"><a href="#用maven插件构建项目框架" class="headerlink" title="用maven插件构建项目框架"></a>用maven插件构建项目框架</h3><p> 打开菜单File –New-MavenProject，点击<strong>Next</strong>，选择maven-archetype-webapp，点击<strong>Next</strong>，如下图：</p>
<p><a target="_blank" rel="noopener" href="http://i.imgur.com/36miC1f.png"><img src="http://i.imgur.com/36miC1f.png" alt="img"></a></p>
<p> 输入Group Id和artifact Id。Group Id一般填入项目名称，Artifact Id一般填入子项目的名称，如下图，点击<strong>完成</strong>。</p>
<p><a target="_blank" rel="noopener" href="http://i.imgur.com/RgEnsHK.png"><img src="http://i.imgur.com/RgEnsHK.png" alt="img"></a></p>
<p> 等待构建完成，生成的项目文件结构如下图所示：</p>
<p><a target="_blank" rel="noopener" href="http://i.imgur.com/L23ah7x.png"><img src="http://i.imgur.com/L23ah7x.png" alt="img"></a></p>
<p> 点击pom.xml文件，进入编辑界面，如下图： <a href="https://the-sword.github.io/2016/09/03/Maven%E6%9E%84%E5%BB%BASpringMVC%E9%A1%B9%E7%9B%AE%E5%AE%9E%E7%8E%B0%E6%B3%A8%E8%A7%A3%E5%8F%8A%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86/pom%E6%96%87%E4%BB%B6.png"><img src="https://the-sword.github.io/2016/09/03/Maven%E6%9E%84%E5%BB%BASpringMVC%E9%A1%B9%E7%9B%AE%E5%AE%9E%E7%8E%B0%E6%B3%A8%E8%A7%A3%E5%8F%8A%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86/pom%E6%96%87%E4%BB%B6.png" alt="pom文件"></a></p>
<p> 增加Properties：展开Properties选项，然后点击<strong>Create…</strong>按钮，如下图所示：然后Name字段填入springVersion，Value字段填入3.2.5.RELEASE。即在pom.xml中增加了一个属性springVersion，属性值为3.2.5.RELEASE（此处value是根据自己所使用的Spring版本设置，由于本人使用的是3.2.5版本，所以填入3.2.5.RELEASE）。</p>
<p><a target="_blank" rel="noopener" href="http://i.imgur.com/3qoICNE.png"><img src="http://i.imgur.com/3qoICNE.png" alt="img"></a></p>
<p> 增加Dependency：点击<strong>Dependencies</strong>标签，进入Dependencies编辑界面，点击<strong>Add…</strong>，添加Dependency属性，此过程是加入springframe的spring-web依赖库，${springVersion}是之前设置的属性，过程如下图所示：</p>
<p> Group Id：org.springframework</p>
<p> Artifact Id：spring-web</p>
<p> Version：${springVersion}</p>
<p> 点击<strong>确定</strong>按钮。</p>
<p><a target="_blank" rel="noopener" href="http://i.imgur.com/tMYI5bg.png"><img src="http://i.imgur.com/tMYI5bg.png" alt="img"></a></p>
<p> 同理再新建一个Dependency，该过程是加入springframe的spring-webmvc依赖库，${springVersion}是之前设置的属性，具体属性值如下所示：</p>
<p> Group Id：org.springframework</p>
<p> Artifact Id：spring-webmvc</p>
<p> Version：${springVersion}</p>
<p> 点击<strong>确定</strong>按钮。</p>
<p> 设置完成之后，Ctrl+S保存，Maven会自动构建工作空间，下载所需要的依赖库文件，下载完成之后，可以看到如下图所示的库文件：</p>
<p>目录结构</p>
<p><a target="_blank" rel="noopener" href="http://i.imgur.com/oBljhHT.png"><img src="http://i.imgur.com/oBljhHT.png" alt="img"></a></p>
<p>注意事项：<br>​ 由于后面会用到C3P0连接池，事务管理，mysql数据库驱动，所以还需要导入如左图蓝色标识的jar包</p>
<h3 id="添加Source-Fold"><a href="#添加Source-Fold" class="headerlink" title="添加Source Fold"></a>添加Source Fold</h3><p> 完善目录，添加source folder（源文件夹）。添加src/main/java，src/test/resources，src/test/java目录，让目录变成标准的maven结构，如下图：</p>
<p><a target="_blank" rel="noopener" href="http://i.imgur.com/KUkXEv3.png"><img src="http://i.imgur.com/KUkXEv3.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="http://i.imgur.com/E3dqazg.png"><img src="http://i.imgur.com/E3dqazg.png" alt="img"></a></p>
<p> 注意：如果Eclipse建立Maven项目后无法建立src/main/java资源文件夹，可以在项目上右键选择properties（首选项），然后点击java build path（java构建路径），在Librarys（库）下，编辑JRE System Library（JRE系统库），选择workspace default jre（工作空间缺省JRE）就可以了。</p>
<h2 id="建立数据库"><a href="#建立数据库" class="headerlink" title="建立数据库"></a>建立数据库</h2><h3 id="新建数据库hib-demo"><a href="#新建数据库hib-demo" class="headerlink" title="新建数据库hib_demo"></a>新建数据库hib_demo</h3><h3 id="新建t-dept-t-employee表，格式分别如下："><a href="#新建t-dept-t-employee表，格式分别如下：" class="headerlink" title="新建t_dept , t_employee表，格式分别如下："></a>新建t_dept , t_employee表，格式分别如下：</h3><p>t_dept</p>
<p><a target="_blank" rel="noopener" href="http://i.imgur.com/YsUIa0y.png"><img src="http://i.imgur.com/YsUIa0y.png" alt="img"></a></p>
<p>t_employee</p>
<p><a target="_blank" rel="noopener" href="http://i.imgur.com/hUE1weU.png"><img src="http://i.imgur.com/hUE1weU.png" alt="img"></a></p>
<h2 id="注解及数据库事务管理"><a href="#注解及数据库事务管理" class="headerlink" title="注解及数据库事务管理"></a>注解及数据库事务管理</h2><h3 id="注解及数据库事务管理代码清单"><a href="#注解及数据库事务管理代码清单" class="headerlink" title="注解及数据库事务管理代码清单"></a>注解及数据库事务管理代码清单</h3><h4 id="Dept-java"><a href="#Dept-java" class="headerlink" title="Dept.java"></a>Dept.java</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">package com.test.dept;</span><br><span class="line">public class Dept &#123;</span><br><span class="line">	private int deptId;</span><br><span class="line">	private String deptName;</span><br><span class="line">	public int getDeptId() &#123;</span><br><span class="line">		return deptId;</span><br><span class="line">	&#125;</span><br><span class="line">	public void setDeptId(int deptId) &#123;</span><br><span class="line">		this.deptId = deptId;</span><br><span class="line">	&#125;</span><br><span class="line">	public String getDeptName() &#123;</span><br><span class="line">		return deptName;</span><br><span class="line">	&#125;</span><br><span class="line">	public void setDeptName(String deptName) &#123;</span><br><span class="line">		this.deptName = deptName;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="DeptDao-java"><a href="#DeptDao-java" class="headerlink" title="DeptDao.java"></a>DeptDao.java</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">package com.test.dept;</span><br><span class="line">import javax.annotation.Resource;</span><br><span class="line">import org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line">import org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * dao实现，使用Spring对jdbc支持功能</span><br><span class="line"> * @author zhou</span><br><span class="line"> */</span><br><span class="line">@Repository</span><br><span class="line">public class DeptDao &#123;</span><br><span class="line">	</span><br><span class="line">	@Resource</span><br><span class="line">	private JdbcTemplate jdbcTemplate;</span><br><span class="line">//	public void save(Dept dept)&#123;</span><br><span class="line">//		String sql = &quot;insert into t_dept (deptName) values(?)&quot;;</span><br><span class="line">//		jdbcTemplate.update(sql,dept.getDeptName());</span><br><span class="line">//	&#125;</span><br><span class="line">	public void save(String empvalue,String deptvalue)&#123;</span><br><span class="line">	String sql1 = &quot;insert into t_employee (empName) values(?)&quot;;</span><br><span class="line">	jdbcTemplate.update(sql1,empvalue);</span><br><span class="line">	String sql2 = &quot;insert into t_dept (deptName) values(?)&quot;;</span><br><span class="line">	jdbcTemplate.update(sql2,deptvalue);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="TestJdbc-java"><a href="#TestJdbc-java" class="headerlink" title="TestJdbc.java"></a>TestJdbc.java</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">package com.test.dept;</span><br><span class="line"></span><br><span class="line">import javax.annotation.Resource;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line">import org.springframework.transaction.annotation.Isolation;</span><br><span class="line">import org.springframework.transaction.annotation.Propagation;</span><br><span class="line">import org.springframework.transaction.annotation.Transactional;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">@Controller</span><br><span class="line">public class TestJdbc &#123;</span><br><span class="line">		// 部门dao</span><br><span class="line">		@Resource</span><br><span class="line">		private DeptDao deptDao;</span><br><span class="line">		/*</span><br><span class="line">		 * 事务控制</span><br><span class="line">		 */</span><br><span class="line">		@Transactional(</span><br><span class="line">				readOnly = false,  // 读写事务</span><br><span class="line">				timeout = -1,       // 事务的超时时间不限制</span><br><span class="line">				//noRollbackFor = ArithmeticException.class,  // 遇到数学异常不回滚</span><br><span class="line">				isolation = Isolation.DEFAULT,              // 事务的隔离级别，数据库的默认</span><br><span class="line">				propagation = Propagation.REQUIRED			// 事务的传播行为</span><br><span class="line">		)</span><br><span class="line">		@RequestMapping(&quot;save.do&quot;)</span><br><span class="line">		public void save(HttpServletRequest request)&#123;</span><br><span class="line">			System.out.println(&quot;成功&quot;);</span><br><span class="line">			String empValue=request.getParameter(&quot;empName&quot;);</span><br><span class="line">			String deptValue=request.getParameter(&quot;deptName&quot;);</span><br><span class="line">            //测试数据库事务，如有异常则回滚此数据库读写操作</span><br><span class="line">			deptDao.save(empValue,deptValue);  // 保存员工名字和部门名字，如有异常则回滚此数据库读写操作</span><br><span class="line">			int i = 1/0;					   //设置异常	</span><br><span class="line">			deptDao.save(empValue,deptValue);  // 保存员工名字和部门名字</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="jsp页面"><a href="#jsp页面" class="headerlink" title="jsp页面"></a>jsp页面</h4><h5 id="input-jsp"><a href="#input-jsp" class="headerlink" title="input.jsp"></a>input.jsp</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;</span><br><span class="line">    pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;</span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	 &lt;form action=&quot;save.do&quot;&gt; </span><br><span class="line">		员工名：&lt;input type=&quot;text&quot; name=&quot;empName&quot;&gt;</span><br><span class="line">		部门名：&lt;input type=&quot;text&quot; name=&quot;deptName&quot;&gt;</span><br><span class="line">		&lt;input type=&quot;submit&quot; value=&quot;提交&quot;&gt;</span><br><span class="line">	&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h5 id="save-jsp"><a href="#save-jsp" class="headerlink" title="save.jsp"></a>save.jsp</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;</span><br><span class="line">    pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;</span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	传入数据库成功</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h3 id="项目进行SpringMvc配置"><a href="#项目进行SpringMvc配置" class="headerlink" title="项目进行SpringMvc配置"></a>项目进行SpringMvc配置</h3><h4 id="配置web-xml"><a href="#配置web-xml" class="headerlink" title="配置web.xml"></a>配置web.xml</h4><p> 配置web.xml，使其具有springmvc特性，主要配置DispatcherServlet。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;web-app xmlns=&quot;http://java.sun.com/xml/ns/javaee&quot;  </span><br><span class="line">      xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;  </span><br><span class="line">      xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd&quot;  </span><br><span class="line">      version=&quot;3.0&quot;&gt;  </span><br><span class="line">    </span><br><span class="line">    &lt;welcome-file-list&gt;input.jsp&lt;/welcome-file-list&gt;</span><br><span class="line">  &lt;!--配置DispatcherServlet表示，该工程将采用springmvc的方式。启动时也会默认在/WEB-INF目录下查找XXX-servlet.xml作为配置文件，XXX就是DispatcherServlet的名字--&gt;</span><br><span class="line">    &lt;servlet&gt;</span><br><span class="line">        &lt;servlet-name&gt;spring&lt;/servlet-name&gt;</span><br><span class="line">        &lt;servlet-class&gt;</span><br><span class="line">            org.springframework.web.servlet.DispatcherServlet</span><br><span class="line">        &lt;/servlet-class&gt;</span><br><span class="line">        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;</span><br><span class="line">    &lt;/servlet&gt;</span><br><span class="line">    &lt;servlet-mapping&gt;</span><br><span class="line">        &lt;servlet-name&gt;spring&lt;/servlet-name&gt;</span><br><span class="line">        &lt;url-pattern&gt;*.do&lt;/url-pattern&gt;</span><br><span class="line">    &lt;/servlet-mapping&gt;  </span><br><span class="line">&lt;/web-app&gt;</span><br></pre></td></tr></table></figure>

<h4 id="配置spring-servlet-xml"><a href="#配置spring-servlet-xml" class="headerlink" title="配置spring-servlet.xml"></a>配置spring-servlet.xml</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;  </span><br><span class="line">    xmlns:context=&quot;http://www.springframework.org/schema/context&quot;  </span><br><span class="line">    xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot; </span><br><span class="line">    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">    xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</span><br><span class="line">	xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;</span><br><span class="line">	xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot;  </span><br><span class="line">    xsi:schemaLocation=&quot;  </span><br><span class="line">        http://www.springframework.org/schema/beans       </span><br><span class="line">        http://www.springframework.org/schema/beans/spring-beans-3.0.xsd  </span><br><span class="line">        http://www.springframework.org/schema/context   </span><br><span class="line">        http://www.springframework.org/schema/context/spring-context-3.0.xsd  </span><br><span class="line">        http://www.springframework.org/schema/mvc  </span><br><span class="line">        http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd</span><br><span class="line">        http://www.springframework.org/schema/aop</span><br><span class="line">        http://www.springframework.org/schema/aop/spring-aop.xsd</span><br><span class="line">        http://www.springframework.org/schema/tx</span><br><span class="line">     	http://www.springframework.org/schema/tx/spring-tx.xsd&quot;&gt;  </span><br><span class="line">    &lt;!--该配置文件将配置两项重要的MVC特性：</span><br><span class="line">		1.HandlerMapping,负责为DispatcherServlet这个前端控制器的请求查找Controller；</span><br><span class="line"></span><br><span class="line">		2.ViewResolver,负责为DispatcherServlet查找Model And View的视图解析器。</span><br><span class="line">--&gt;</span><br><span class="line">    &lt;!-- 1. 数据源对象: C3P0连接池  我用的是Mysql数据库，不同数据库此处配置有所不同--&gt;</span><br><span class="line">	&lt;bean id=&quot;dataSource&quot; class=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;&gt;</span><br><span class="line">		&lt;property name=&quot;driverClass&quot; value=&quot;com.mysql.jdbc.Driver&quot;&gt;&lt;/property&gt;</span><br><span class="line">		&lt;property name=&quot;jdbcUrl&quot; value=&quot;jdbc:mysql:///hib_demo&quot;&gt;&lt;/property&gt;</span><br><span class="line">		&lt;property name=&quot;user&quot; value=&quot;root&quot;&gt;&lt;/property&gt;</span><br><span class="line">		&lt;property name=&quot;password&quot; value=&quot;root&quot;&gt;&lt;/property&gt;</span><br><span class="line">		&lt;property name=&quot;initialPoolSize&quot; value=&quot;3&quot;&gt;&lt;/property&gt;</span><br><span class="line">		&lt;property name=&quot;maxPoolSize&quot; value=&quot;10&quot;&gt;&lt;/property&gt;</span><br><span class="line">		&lt;property name=&quot;maxStatements&quot; value=&quot;100&quot;&gt;&lt;/property&gt;</span><br><span class="line">		&lt;property name=&quot;acquireIncrement&quot; value=&quot;2&quot;&gt;&lt;/property&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;!-- 2. JdbcTemplate工具类实例 --&gt;</span><br><span class="line">	&lt;bean id=&quot;jdbcTemplate&quot; class=&quot;org.springframework.jdbc.core.JdbcTemplate&quot;&gt;</span><br><span class="line">		&lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;&lt;/property&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;!-- 事务管理器类 --&gt;</span><br><span class="line">	&lt;bean id=&quot;txManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;</span><br><span class="line">		&lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;&lt;/property&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;!-- 对包中的所有类进行扫描，以完成Bean创建和自动依赖注入的功能需要更改 --&gt;</span><br><span class="line">	&lt;context:component-scan base-package=&quot;com.test.dept&quot;&gt;&lt;/context:component-scan&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;!-- 注解方式实现事务： 指定注解方式实现事务 --&gt;</span><br><span class="line">	&lt;tx:annotation-driven transaction-manager=&quot;txManager&quot;/&gt;</span><br><span class="line">	</span><br><span class="line">    &lt;bean id=&quot;viewResolver&quot;  </span><br><span class="line">        class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt;  </span><br><span class="line">        &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/view/&quot; /&gt;  </span><br><span class="line">        &lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot; /&gt;  </span><br><span class="line">    &lt;/bean&gt;  </span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>

<p> 写完之后，项目结构如下：</p>
<p><a target="_blank" rel="noopener" href="http://i.imgur.com/uLSaYZb.png"><img src="http://i.imgur.com/uLSaYZb.png" alt="img"></a></p>
<h3 id="测试结果"><a href="#测试结果" class="headerlink" title="测试结果"></a>测试结果</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">启动Tomcat，运行项目，进入input页面，如下图：</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="http://i.imgur.com/n2aA7GC.png"><img src="http://i.imgur.com/n2aA7GC.png" alt="img"></a></p>
<p> 会弹出如下提示，是因为我们加了int i =1/0；这个异常：</p>
<p><a target="_blank" rel="noopener" href="http://i.imgur.com/q5x59Zg.png"><img src="http://i.imgur.com/q5x59Zg.png" alt="img"></a></p>
<p> 最后去查找数据库发现，在异常之前进行的数据库也已回滚，并未产生读写，说明数据库事务管理成功!</p>
<h2 id="spring使用JdbcTemplate实现MySQL存储过程"><a href="#spring使用JdbcTemplate实现MySQL存储过程" class="headerlink" title="spring使用JdbcTemplate实现MySQL存储过程"></a>spring使用JdbcTemplate实现MySQL存储过程</h2><h3 id="存储过程优点"><a href="#存储过程优点" class="headerlink" title="存储过程优点"></a>存储过程优点</h3><p> 存储过程（Stored Procedure）是一组为了完成特定功能的SQL语句集，经编译后存储在数据库中，用户通过指定存储过程的名字并给定参数（如果该存储过程带有参数）来调用执行它。</p>
<p> 一个存储过程是一个可编程的函数，它在数据库中创建并保存。它可以有SQL语句和一些特殊的控制结构组成。当希望在不同的应用程序或平台上执行相同的函数，或者封装特定功能时，存储过程是非常有用的。数据库中的存储过程可以看做是对编程中面向对象方法的模拟。</p>
<p> 存储过程通常有以下优点：</p>
<p> 1）存储过程增强了SQL语言的功能和灵活性。存储过程可以用流控制语句编写，有很强的灵活性，可以完成复杂的判断和较复杂的运算。</p>
<p> 2）存储过程允许标准组件是编程。存储过程被创建后，可以在程序中被多次调用，而不必重新编写该存储过程的SQL语句。而且数据库专业人员可以随时对存储过程进行修改，对应用程序源代码毫无影响.</p>
<p> 3）存储过程能实现较快的执行速度。如果某一操作包含大量的Transaction-SQL代码或分别被多次执行，那么存储过程要比批处理的执行速度快很多。因为存储过程是预编译的。在首次运行一个存储过程时查询，优化器对其进行分析优化，并且给出最终被存储在系统表中的执行计划。而批处理的Transaction-SQL语句在每次运行时都要进行编译和优化，速度相对要慢一些。</p>
<p> 4）存储过程能过减少网络流量。针对同一个数据库对象的操作（如查询、修改），如果这一操作所涉及的Transaction-SQL语句被组织程存储过程，那么当在客户计算机上调用该存储过程时，网络中传送的只是该调用语句，从而大大增加了网络流量并降低了网络负载。</p>
<p> 5）存储过程可被作为一种安全机制来充分利用。系统管理员通过执行某一存储过程的权限进行限制，能够实现对相应的数据的访问权限的限制，避免了非授权用户对数据的访问，保证了数据的安全。</p>
<h3 id="JdbcTemplate使用参考一下链接"><a href="#JdbcTemplate使用参考一下链接" class="headerlink" title="JdbcTemplate使用参考一下链接"></a>JdbcTemplate使用参考一下链接</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://www.cnblogs.com/lichenwei/p/3902294.html</span><br><span class="line"></span><br><span class="line">http://lehsyh.iteye.com/blog/1579737</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Spring使用JdbcTemplate调用Mysql存储过程："><a href="#Spring使用JdbcTemplate调用Mysql存储过程：" class="headerlink" title="Spring使用JdbcTemplate调用Mysql存储过程："></a>Spring使用JdbcTemplate调用Mysql存储过程：</h3><h4 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h4><p> 语法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE PROCEDURE sp_name ([ proc_parameter ]) [ characteristics..] routine_body</span><br></pre></td></tr></table></figure>

<p> proc_parameter指定存储过程的参数列表，列表形式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[IN|OUT|INOUT] param_name type</span><br></pre></td></tr></table></figure>

<p> 其中in表示输入参数，out表示输出参数，inout表示既可以输入也可以输出；param_name表示参数名称；type表示参数的类型，该类型可以是MYSQL数据库中的任意类型。</p>
<p> 语法构建模板：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">characteristic: </span><br><span class="line">    LANGUAGE SQL </span><br><span class="line">  | [NOT] DETERMINISTIC </span><br><span class="line">  | &#123; CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA &#125; </span><br><span class="line">  | SQL SECURITY &#123; DEFINER | INVOKER &#125; </span><br><span class="line">  | COMMENT &#x27;string&#x27; </span><br><span class="line">routine_body: </span><br><span class="line">    Valid SQL procedure statement or statements</span><br></pre></td></tr></table></figure>

<p> <strong>LANGUAGE SQL</strong> ：说明routine_body部分是由SQL语句组成的，当前系统支持的语言为SQL，SQL是LANGUAGE特性的唯一值</p>
<p> <strong>[NOT] DETERMINISTIC</strong> ：指明存储过程执行的结果是否正确。DETERMINISTIC 表示结果是确定的。每次执行存储过程时，相同的输入会得到相同的输出。</p>
<p> [NOT] DETERMINISTIC 表示结果是不确定的，相同的输入可能得到不同的输出。如果没有指定任意一个值，默认为[NOT] DETERMINISTIC</p>
<p> <strong>CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA</strong>：指明子程序使用SQL语句的限制。</p>
<p> CONTAINS SQL表明子程序包含SQL语句，但是不包含读写数据的语句；</p>
<p> NO SQL表明子程序不包含SQL语句；</p>
<p> READS SQL DATA：说明子程序包含读数据的语句；</p>
<p> MODIFIES SQL DATA表明子程序包含写数据的语句。</p>
<p> 默认情况下，系统会指定为CONTAINS SQL</p>
<p> <strong>SQL SECURITY { DEFINER | INVOKER }</strong> ：指明谁有权限来执行。DEFINER 表示只有定义者才能执行</p>
<p> INVOKER 表示拥有权限的调用者可以执行。默认情况下，系统指定为DEFINER</p>
<p> COMMENT ‘string’ ：注释信息，可以用来描述存储过程或函数</p>
<p> routine_body是SQL代码的内容，可以用BEGIN…END来表示SQL代码的开始和结束。</p>
<p> 下面的语句创建一个查询t1表全部数据的存储过程</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">DROP PROCEDURE IF EXISTS Proc;      </span><br><span class="line">DELIMITER //    </span><br><span class="line">CREATE PROCEDURE Proc()     </span><br><span class="line">BEGIN     </span><br><span class="line">SELECT * FROM t3;	</span><br><span class="line">END//</span><br><span class="line">DELIMITER ;</span><br><span class="line">CALL Proc();</span><br></pre></td></tr></table></figure>

<p> <strong>注意：“DELIMITER //”语句的作用是将MYSQL的结束符设置为//，因为MYSQL默认的语句结束符为分号;，为了避免与存储过程*中SQL语句结束符相冲突，需要使用DELIMITER 改变存储过程的结束符，并以“END//”结束存储过程。</strong></p>
<p> <strong>存储过程定义完毕之后再使用DELIMITER ;恢复默认结束符。DELIMITER 也可以指定其他符号为结束符！！！！！！！！！！！</strong></p>
<p> <strong>注意：当使用DELIMITER命令时，应该避免使用反斜杠（\）字符，因为反斜杠是MYSQL的转义字符！！！</strong></p>
<h4 id="无返回值的存储过程调用"><a href="#无返回值的存储过程调用" class="headerlink" title="无返回值的存储过程调用"></a>无返回值的存储过程调用</h4><h5 id="存储过程代码："><a href="#存储过程代码：" class="headerlink" title="存储过程代码："></a>存储过程代码：</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">DROP PROCEDURE IF EXISTS testProcedure; </span><br><span class="line"></span><br><span class="line">DELIMITER //</span><br><span class="line">CREATE PROCEDURE testProcedure(IN empNameValue  VARCHAR(20),IN deptNameValue  VARCHAR(20))</span><br><span class="line">BEGIN</span><br><span class="line">INSERT INTO t_employee(empName) VALUES(empNameValue);</span><br><span class="line">INSERT INTO t_dept(deptName) VALUES(deptNameValue);  </span><br><span class="line">END//</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>

<h5 id="JdbcTemplate调用该存储过程代码："><a href="#JdbcTemplate调用该存储过程代码：" class="headerlink" title="JdbcTemplate调用该存储过程代码："></a>JdbcTemplate调用该存储过程代码：</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">package com.test.procedure;     </span><br><span class="line">import java.sql.CallableStatement;</span><br><span class="line">import java.sql.Connection;</span><br><span class="line">import java.sql.SQLException;</span><br><span class="line">import java.sql.Types;</span><br><span class="line">import javax.annotation.Resource;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import org.springframework.dao.DataAccessException;</span><br><span class="line">import org.springframework.jdbc.core.CallableStatementCallback;</span><br><span class="line">import org.springframework.jdbc.core.CallableStatementCreator;</span><br><span class="line">import org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">@Controller</span><br><span class="line">public class CallProcedure &#123; </span><br><span class="line">  @Resource</span><br><span class="line">  private JdbcTemplate jdbcTemplate;     </span><br><span class="line">  public void setJdbcTemplate(JdbcTemplate jdbcTemplate) &#123;     </span><br><span class="line">  this.jdbcTemplate = jdbcTemplate;     </span><br><span class="line">  &#125;    </span><br><span class="line">  @RequestMapping(&quot;testProcedure.do&quot;)</span><br><span class="line">  public void testProcedure()&#123;   </span><br><span class="line">     final String empValue=request.getParameter(&quot;empName&quot;);</span><br><span class="line">	 final String deptValue=request.getParameter(&quot;deptName&quot;);</span><br><span class="line">     this.jdbcTemplate.execute(&quot;call testProcedure(&#x27;&quot;+empValue+&quot;&#x27;,&#x27;&quot;+deptValue+&quot;&#x27;)&quot;);     </span><br><span class="line">  &#125;     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="有返回值的存储过程（非结果集）"><a href="#有返回值的存储过程（非结果集）" class="headerlink" title="有返回值的存储过程（非结果集）"></a>有返回值的存储过程（非结果集）</h4><h5 id="存储过程代码：-1"><a href="#存储过程代码：-1" class="headerlink" title="存储过程代码："></a>存储过程代码：</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">DROP PROCEDURE IF EXISTS testProcedure; </span><br><span class="line"></span><br><span class="line">DELIMITER //</span><br><span class="line">CREATE PROCEDURE testProcedure(IN empNameValue  VARCHAR(20),IN deptNameValue  VARCHAR(20),OUT employeeName INT(11))</span><br><span class="line">BEGIN</span><br><span class="line">SELECT dept_id INTO employeeName FROM t_employee WHERE empId=1;</span><br><span class="line">INSERT INTO t_employee(empName) VALUES(empNameValue);</span><br><span class="line">INSERT INTO t_dept(deptName) VALUES(deptNameValue);</span><br><span class="line">  </span><br><span class="line">END//</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>

<h5 id="JdbcTemplate调用该存储过程代码：-1"><a href="#JdbcTemplate调用该存储过程代码：-1" class="headerlink" title="JdbcTemplate调用该存储过程代码："></a>JdbcTemplate调用该存储过程代码：</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">package com.test.procedure;</span><br><span class="line"></span><br><span class="line">import java.sql.CallableStatement;</span><br><span class="line">import java.sql.Connection;</span><br><span class="line">import java.sql.SQLException;</span><br><span class="line">import java.sql.Types;</span><br><span class="line">import javax.annotation.Resource;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import org.springframework.dao.DataAccessException;</span><br><span class="line">import org.springframework.jdbc.core.CallableStatementCallback;</span><br><span class="line">import org.springframework.jdbc.core.CallableStatementCreator;</span><br><span class="line">import org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">@Controller</span><br><span class="line">public class CallProcedure &#123;</span><br><span class="line">	@Resource</span><br><span class="line">	public JdbcTemplate jdbcTemplate;</span><br><span class="line">	public void setJdbcTemplate(JdbcTemplate jdbcTemplate) &#123;</span><br><span class="line">		this.jdbcTemplate = jdbcTemplate;</span><br><span class="line">	&#125;</span><br><span class="line">	@RequestMapping(&quot;testProcedure.do&quot;)</span><br><span class="line">	public void testProcedure(HttpServletRequest request)&#123;</span><br><span class="line">		final String empValue=request.getParameter(&quot;empName&quot;);</span><br><span class="line">		final String deptValue=request.getParameter(&quot;deptName&quot;);</span><br><span class="line">		//传入从jsp获取的参数</span><br><span class="line">		//this.jdbcTemplate.execute(&quot;call testProcedure(&#x27;&quot;+empValue+&quot;&#x27;,&#x27;&quot;+deptValue+&quot;&#x27;)&quot;);</span><br><span class="line">		String empTable=(String) jdbcTemplate.execute(new CallableStatementCreator() &#123;	</span><br><span class="line">			public CallableStatement createCallableStatement(Connection con)</span><br><span class="line">					throws SQLException &#123;</span><br><span class="line">				CallableStatement cs = con.prepareCall(&quot;call testProcedure(?,?,?)&quot;);   </span><br><span class="line">		           cs.setString(1, empValue);// 设置输入参数的值   </span><br><span class="line">		           cs.setString(2, deptValue);</span><br><span class="line">		           cs.registerOutParameter(3,Types.VARCHAR);// 注册输出参数的类型   </span><br><span class="line">		           return cs; </span><br><span class="line">			&#125;</span><br><span class="line">		&#125;, new CallableStatementCallback&lt;Object&gt;() &#123;</span><br><span class="line"></span><br><span class="line">			public Object  doInCallableStatement(CallableStatement cs)</span><br><span class="line">					throws SQLException, DataAccessException &#123;</span><br><span class="line">				cs.execute();   </span><br><span class="line">		           return cs.getString(3);// 获取输出参数的值</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">		System.out.println(empTable);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Xiao Hui</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://the-sword.github.io/posts/da9313af/">https://the-sword.github.io/posts/da9313af/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://the-sword.github.io">XIAOHUI'S BLOG</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SpringMVC/">SpringMVC</a></div><div class="social-share pull-right" data-disabled="google,facebook"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script><nav id="pagination"><div class="prev-post pull-left"><a href="/posts/e13fec62/"><i class="fa fa-chevron-left">  </i><span>资源链接</span></a></div><div class="next-post pull-right"><a href="/posts/2ecaa025/"><span>MySQL server has gone away</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '3e8c1efea0f5b1d9cbc6',
  clientSecret: 'dd7d0373189cf1d1d9e6b6bf8fc66e42ef8913ae',
  repo: 'gittalk-comment',
  owner: 'the-sword',
  admin: 'the-sword',
  id: md5(decodeURI(location.pathname)),
  language: 'zh-CN'
})
gitalk.render('gitalk-container')</script></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2016 - 2021 By Xiao Hui</div><div class="framework-info"><span>驱动 - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">hitokoto</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  CommonHTML: {
    linebreaks: { automatic: true, width: "90% container" }
  },
  "HTML-CSS": { 
    linebreaks: { automatic: true, width: "90% container" }
  },
  "SVG": { 
    linebreaks: { automatic: true, width: "90% container" }
  }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.jsdelivr.net/npm/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script src="/js/search/local-search.js"></script><script id="ribbon" src="/js/third-party/canvas-ribbon.js" size="150" alpha="0.6" zIndex="-1" data-click="true"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":60,"height":120},"mobile":{"show":true},"log":false,"tagMode":false});</script></body></html>